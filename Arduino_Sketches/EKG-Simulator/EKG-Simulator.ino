#include <TimerOne.h>

const int ekgData[] PROGMEM = {
274,270,257,258,260,318,449,617,743,691,523,349,256,192,180,211,254,219,198,214,211,198,217,218,225,247,243,258,250,236,249,259,
288,268,247,281,291,269,266,290,281,258,283,312,287,257,277,325,336,314,293,296,289,271,312,315,345,313,300,312,330,295,281,337,
352,317,281,307,306,347,332,332,322,310,269,310,340,315,282,278,301,293,263,293,311,280,256,282,299,305,290,294,314,295,285,298,
308,277,276,302,317,290,285,286,300,307,312,303,291,275,287,315,331,314,285,297,303,279,263,274,293,315,296,314,298,271,281,306,
327,307,285,293,317,308,294,303,307,293,284,300,317,290,279,300,310,298,283,293,310,297,280,292,310,291,281,295,306,299,290,304,
319,298,285,309,309,297,280,298,321,301,286,299,313,307,296,314,329,323,332,348,352,332,317,324,333,325,295,291,293,273,253,262,
281,267,255,274,290,278,271,288,299,283,267,287,306,282,251,244,258,298,412,569,689,671,536,356,241,209,209,227,243,228,213,228,
243,223,220,244,267,251,241,264,273,266,262,283,291,276,265,290,304,290,280,293,299,286,283,296,306,289,293,321,323,299,301,313,
321,315,302,318,335,311,296,316,336,330,323,323,335,329,314,328,340,323,312,327,328,315,304,314,321,298,279,292,299,280,272,285,
293,282,268,277,290,281,277,291,294,287,277,293,301,295,280,302,304,298,290,300,305,294,279,304,321,302,285,299,317,294,284,300,
319,293,287,295,314,295,282,301,312,300,292,300,304,299,279,292,309,298,279,297,312,304,292,305,309,298,289,304,313,295,279,297,
320,300,292,304,312,294,284,300,315,300,292,303,314,290,274,297,319,304,293,320,332,323,315,330,341,333,324,340,344,324,305,302,
304,281,264,277,282,270,266,285,299,280,268,279,289,282,275,289,310,293,270,267,259,245,267,398,543,647,658,549,365,226,188,221,
249,235,221,233,250,237,224,241,256,243,241,259,276,268,263,280,285,266,259,282,298,282,274,294,305,287,289,297,301,283,289,305,
311,305,301,320,324,307,300,320,334,314,308,326,333,316,298,327,340,322,321,333,344,326,313,319,336,321,311,324,326,299,279,286,
303,286,277,289,292,277,267,275,297,284,280,297,303,281,266,290,308,296,285,305,319,297,284,293,317,302,289,304,318,301,287,292,
303,293,290,308,312,291,280,298,305,284,278,301,311,296,285,302,305,281,270,306,316,300,288,304,311,289,282,298,315,297,289,304,
307,280,285,310,320,298,285,299,308,296,289,302,316,302,285,300,313,293,276,294,305,282,287,312,314,294,300,313,320,329,314,321,
345,322,315,347,371,320,293,322,327,268,247,274,269,289,321,303,251,269,262,275,290,279,277,291,314,286,282,287,281,255,260,358,
499,640,719,661,485,303,217,219,235,236,228,211,219,211,200,219,244,240,209,233,262,252,249,266,285,263,240,262,285,269,271,277,
288,288,277,294,293,275,278,307,293,280,289,323,319,294,300,322,329,302,285,322,329,296,296,320,351,319,287,301,323,315,310,332,
370,308,263,314,324,307,293,301,312,269,271,289,311,294,254,281,276,271,273,302,326,268,268,293,304,281,277,307,317,281,278,304,
309,295,300,310,306,302,298,293,313,299,273,286,299,298,299,317,303,286,269,287,305,280,277,298,314,303,272,291,312,293,286,301,
329,305,277,297,303,294,286,299,301,292,294,307,302,302,310,317,313,314,304,306,311,280,288,344,305,295,279,308,321,312,307,302,
304,323,311,303,317,287,288,308,307,319,321,328,335,316,322,335,345,337,336,332,328,303,284,297,312,307,285,257,279,284,269,257,
274,264,271,272,291,294,294,315,293,270,246,259,270,261,359,513,662,729,653,479,317,189,205,217,209,168,186,208,214,210,223,230,
223,225,227,269,259,247,217,266,287,280,260,268,280,289,295,303,286,284,290,311,316,297,289,308,319,331,307,314,311,302,311,336,
330,314,317,328,343,317,303,335,360,334,306,320,333,316,318,336,343,319,313,327,324,293,286,311,317,287,272,288,295,287,268,305,
308,285,272,286,298,283,270,308,320,304,284,297,286,284,289,303,308,287,274,290,295,290,297,318,322,301,292,301,297,279,281,295,
308,295,289,306,308,280,282,310,306,288,281,302,321,291,281,298,304,292,281,290,309,299,298,310,305,294,298,318,309,290,289,300,
311,295,284,297,304,293,294,307,311,288,289,312,314,294,290,309,313,296,294,296,314,301,286,303,311,302,307,321,327,319,319,340,
345,332,334,352,346,313,307,325};

int i = 0;
int faADC  = 200;
long t_alt = 0;

void setup() {
  // put your setup code here, to run once:
  Serial.begin(115200);
  Timer1.initialize(1000000/faADC);             
  Timer1.attachInterrupt(readADC);                             
}

void loop() {
}

void readADC() {
  int adcValue = pgm_read_word(&ekgData[i]);
  i++;
  if (i>=1000) {
    i = 0;
  }
  int t = millis() - t_alt;
  t_alt = millis();
  Serial.print("EKG:");
  Serial.print(adcValue);
  Serial.print(",t:");
  Serial.println(t);
}

void serialEvent() {
  char inChar = Serial.read();
  if (inChar == 's') {   // 's'top
    Timer1.stop();
  }
  if (inChar == 't') {   //  restar't'
    Timer1.restart();
  }
}
